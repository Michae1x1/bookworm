{"version":3,"file":"index-DC_XfOMt.js","sources":["../../src/main.ts"],"sourcesContent":["import type {\n  Config,\n  Book,\n  GutendexResponse,\n  RandomBookFeedOptions,\n  FeedStats,\n  GetNextResult,\n  SeededRandomFunction,\n  FavoritesList,\n} from './types';\n\n// ============ Configuration Constants ============\nconst CONFIG: Config = {\n  // API\n  GUTENDEX_BASE_URL: 'https://gutendex.com',\n\n  // Feed Configuration\n  PREFETCH_THRESHOLD: 20, // Start prefetching when 20 books remain in buffer\n  INITIAL_BATCH_SIZE: 40, // Load 40 books upfront for large initial cache\n  LOAD_BATCH_SIZE: 25, // Load 25 more books in background\n  LOAD_MORE_COUNT: 5,\n  MAX_ROUNDS: 5,\n  ID_MULTIPLIER: 2.0, // Request 2x IDs to minimize API round trips (~93% hit rate)\n  MAX_ID_ATTEMPTS_MULTIPLIER: 10,\n\n  // Catalog Settings\n  MIN_CATALOG_ID: 1,\n  MAX_CATALOG_ID: 75000,\n  MAX_CATALOG_PERCENTAGE: 0.9, // Stop when 90% of IDs have been tried\n  MAX_ID_BUFFER: 500, // Add buffer when determining max ID\n\n  // Timing\n  LOADING_POLL_INTERVAL_MS: 100,\n  LOADING_TIMEOUT_MS: 30000, // 30 seconds max wait\n  COPY_FEEDBACK_DURATION_MS: 2000,\n\n  // Intersection Observer\n  INTERSECTION_ROOT_MARGIN: '200px',\n  INTERSECTION_THRESHOLD: 0,\n};\n\n// ============ Gutendex API Client ============\nconst GUTENDEX_BASE_URL = CONFIG.GUTENDEX_BASE_URL;\n\n/**\n * Creates a seeded pseudo-random number generator using SplitMix32 algorithm\n * Based on MurmurHash3's finalizer\n *\n * @param seed - Initial seed value (will be normalized to 32-bit integer)\n * @returns Function that returns random numbers in range [0, 1)\n */\nfunction createSeededRandom(seed: number): SeededRandomFunction {\n  // Normalize seed to handle edge cases\n  // Convert to number, default to current timestamp if invalid\n  let normalizedSeed = Number(seed);\n\n  // Handle NaN, Infinity, or other invalid values\n  if (!isFinite(normalizedSeed)) {\n    normalizedSeed = Date.now();\n  }\n\n  // Convert to 32-bit integer to ensure consistent behavior\n  normalizedSeed = normalizedSeed | 0;\n\n  return function (): number {\n    // SplitMix32 algorithm\n    // 0x6D2B79F5 is a magic constant from MurmurHash3\n    let t = (normalizedSeed += 0x6d2b79f5);\n    t = Math.imul(t ^ (t >>> 15), t | 1);\n    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);\n\n    // Convert to [0, 1) range\n    // >>> 0 converts to unsigned 32-bit integer\n    // Division by 2^32 normalizes to [0, 1)\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n  };\n}\n\n/**\n * Shuffles an array using the Fisher-Yates algorithm with a seeded RNG\n * Creates a new array; does not mutate the original\n *\n * @param array - Array to shuffle (shallow copied)\n * @param random - Seeded random function returning [0, 1)\n * @returns New shuffled array\n */\nfunction seededShuffle<T>(array: T[], random: SeededRandomFunction): T[] {\n  const shuffled = [...array];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(random() * (i + 1));\n    [shuffled[i]!, shuffled[j]!] = [shuffled[j]!, shuffled[i]!];\n  }\n  return shuffled;\n}\n\n/**\n * TrueRandomBookFeed - Samples individual random IDs across entire catalog\n * Uses batch ID queries for efficiency while maintaining true randomness\n */\nclass RandomBookFeed {\n  private seed: number;\n  private random: SeededRandomFunction;\n  private languages: string | null;\n  private prefetchThreshold: number;\n  private minId: number;\n  private maxId: number;\n  private buffer: Book[] = [];\n  private seenIds = new Set<number>();\n  private failedIds = new Set<number>();\n  private isInitialized = false;\n  private isLoading = false;\n  private hasMore = true;\n  private totalAttempted = 0;\n  private totalFound = 0;\n\n  constructor(options: RandomBookFeedOptions = {}) {\n    this.seed = options.seed || Date.now();\n    this.random = createSeededRandom(this.seed);\n    this.languages = options.languages || null;\n    this.prefetchThreshold = options.prefetchThreshold || CONFIG.PREFETCH_THRESHOLD;\n\n    // ID range for Gutenberg (approximately 1 to 75000, with gaps)\n    this.minId = CONFIG.MIN_CATALOG_ID;\n    this.maxId = CONFIG.MAX_CATALOG_ID;\n  }\n\n  async initialize(): Promise<{ maxId: number; seed: number }> {\n    if (this.isInitialized) {\n      return { maxId: this.maxId, seed: this.seed };\n    }\n\n    // Get the highest ID to refine our range\n    try {\n      const response = await fetch(`${GUTENDEX_BASE_URL}/books?sort=descending`);\n      const data: GutendexResponse = await response.json();\n      if (data.results && data.results.length > 0) {\n        // Set maxId slightly above the highest known ID\n        this.maxId = Math.max(...data.results.map((b) => b.id)) + CONFIG.MAX_ID_BUFFER;\n      }\n    } catch (e) {\n      console.warn('Could not determine max ID, using default');\n    }\n\n    // Pre-fill buffer with initial batch\n    await this.loadRandomBatch(CONFIG.INITIAL_BATCH_SIZE);\n    this.isInitialized = true;\n\n    return { maxId: this.maxId, seed: this.seed };\n  }\n\n  /**\n   * Generate N unique random IDs we haven't tried yet\n   */\n  private generateRandomIds(count: number): number[] {\n    const ids = new Set<number>();\n    let attempts = 0;\n    const maxAttempts = count * CONFIG.MAX_ID_ATTEMPTS_MULTIPLIER;\n\n    while (ids.size < count && attempts < maxAttempts) {\n      const id = Math.floor(this.random() * this.maxId) + this.minId;\n      if (!this.seenIds.has(id) && !this.failedIds.has(id)) {\n        ids.add(id);\n      }\n      attempts++;\n    }\n\n    return Array.from(ids);\n  }\n\n  /**\n   * Fetch books by IDs using Gutendex batch endpoint\n   */\n  private async fetchByIds(ids: number[]): Promise<Book[]> {\n    if (ids.length === 0) return [];\n\n    const url = new URL(`${GUTENDEX_BASE_URL}/books`);\n    url.searchParams.append('ids', ids.join(','));\n\n    if (this.languages) {\n      url.searchParams.append('languages', this.languages);\n    }\n\n    try {\n      const response = await fetch(url.toString());\n      if (!response.ok) throw new Error(`HTTP ${response.status}`);\n      const data: GutendexResponse = await response.json();\n      return data.results || [];\n    } catch (error) {\n      console.error('Batch fetch error:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Load a batch of random books\n   */\n  private async loadRandomBatch(targetCount = 10): Promise<void> {\n    if (this.isLoading) return;\n    this.isLoading = true;\n\n    try {\n      let collected: Book[] = [];\n      let rounds = 0;\n      const maxRounds = CONFIG.MAX_ROUNDS;\n\n      // Keep trying until we have enough books or hit max rounds\n      while (collected.length < targetCount && rounds < maxRounds) {\n        // Request more IDs than needed to account for invalid ones\n        // Gutenberg has ~70k books across ~75k IDs, so ~93% hit rate\n        const idsToTry = Math.ceil((targetCount - collected.length) * CONFIG.ID_MULTIPLIER);\n        const randomIds = this.generateRandomIds(idsToTry);\n\n        this.totalAttempted += randomIds.length;\n\n        // Mark all as seen to prevent re-fetching\n        randomIds.forEach((id) => this.seenIds.add(id));\n\n        // Fetch books\n        const books = await this.fetchByIds(randomIds);\n\n        // Track which IDs were valid\n        const foundIds = new Set(books.map((b) => b.id));\n        randomIds.forEach((id) => {\n          if (!foundIds.has(id)) {\n            this.failedIds.add(id);\n          }\n        });\n\n        this.totalFound += books.length;\n        collected.push(...books);\n        rounds++;\n      }\n\n      // Shuffle the collected books for extra randomness\n      const shuffled = seededShuffle(collected, this.random);\n      this.buffer.push(...shuffled);\n\n      // Check if we're running out of IDs\n      if (this.seenIds.size + this.failedIds.size > this.maxId * CONFIG.MAX_CATALOG_PERCENTAGE) {\n        this.hasMore = false;\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  async getNext(count = 1): Promise<GetNextResult> {\n    if (!this.isInitialized) {\n      await this.initialize();\n    }\n\n    // Prefetch if running low\n    if (this.buffer.length < this.prefetchThreshold && this.hasMore && !this.isLoading) {\n      this.loadRandomBatch(CONFIG.LOAD_BATCH_SIZE).catch(console.error);\n    }\n\n    // Wait for loading if buffer is empty\n    if (this.buffer.length === 0 && this.isLoading) {\n      await new Promise<void>((resolve, reject) => {\n        const timeout = setTimeout(() => {\n          clearInterval(check);\n          reject(new Error('Loading timeout - books failed to load'));\n        }, CONFIG.LOADING_TIMEOUT_MS);\n\n        const check = setInterval(() => {\n          if (!this.isLoading || this.buffer.length > 0) {\n            clearInterval(check);\n            clearTimeout(timeout);\n            resolve();\n          }\n        }, CONFIG.LOADING_POLL_INTERVAL_MS);\n      });\n    }\n\n    const books = this.buffer.splice(0, count);\n\n    // Trigger background prefetch\n    if (this.buffer.length < this.prefetchThreshold && this.hasMore && !this.isLoading) {\n      this.loadRandomBatch(CONFIG.LOAD_BATCH_SIZE).catch(console.error);\n    }\n\n    return {\n      books,\n      hasMore: this.hasMore || this.buffer.length > 0,\n    };\n  }\n\n  getStats(): FeedStats {\n    return {\n      attempted: this.totalAttempted,\n      found: this.totalFound,\n      hitRate:\n        this.totalAttempted > 0\n          ? ((this.totalFound / this.totalAttempted) * 100).toFixed(1) + '%'\n          : 'N/A',\n      bufferSize: this.buffer.length,\n      seenCount: this.seenIds.size,\n    };\n  }\n}\n\n// ============ Favorites Management ============\n\nconst FAVORITES_KEY = 'bookworm_favorites';\n\n// Cache for favorites to avoid repeated localStorage reads\nlet favoritesCache: FavoritesList | null = null;\n\nfunction getFavorites(): FavoritesList {\n  // Return cached value if available\n  if (favoritesCache !== null) {\n    return favoritesCache;\n  }\n\n  try {\n    const stored = localStorage.getItem(FAVORITES_KEY);\n    const favorites: FavoritesList = stored ? JSON.parse(stored) : [];\n    favoritesCache = favorites;\n    return favorites;\n  } catch (e) {\n    console.error('Failed to load favorites:', e);\n    favoritesCache = [];\n    return [];\n  }\n}\n\nfunction saveFavorites(favorites: FavoritesList): void {\n  try {\n    localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));\n    // Update cache on successful save\n    favoritesCache = favorites;\n  } catch (e) {\n    console.error('Failed to save favorites:', e);\n\n    // Handle quota exceeded error\n    if (e instanceof Error && e.name === 'QuotaExceededError') {\n      alert('Storage quota exceeded! Your favorites list is full. Please remove some items to add new ones.');\n    } else {\n      alert('Failed to save favorites. Please try again.');\n    }\n\n    // Re-throw to let caller know save failed\n    throw e;\n  }\n}\n\nfunction isFavorited(bookId: number): boolean {\n  const favorites = getFavorites();\n  return favorites.some((book) => book.id === bookId);\n}\n\nfunction toggleFavorite(book: Book): boolean {\n  const favorites = getFavorites();\n  const index = favorites.findIndex((b) => b.id === book.id);\n\n  if (index >= 0) {\n    // Remove from favorites\n    favorites.splice(index, 1);\n  } else {\n    // Add to favorites\n    favorites.push(book);\n  }\n\n  try {\n    saveFavorites(favorites);\n    updateFavoritesCount();\n    return index < 0; // Return true if added, false if removed\n  } catch (e) {\n    // Save failed, revert the change\n    if (index >= 0) {\n      favorites.push(book);\n    } else {\n      favorites.pop();\n    }\n    return index >= 0; // Return current state (unchanged)\n  }\n}\n\nfunction updateFavoritesCount(): void {\n  const count = getFavorites().length;\n  const countElements = document.querySelectorAll('.favorites-count');\n  countElements.forEach((el) => {\n    el.textContent = count.toString();\n    // Keep badge hidden\n    (el as HTMLElement).style.display = 'none';\n  });\n}\n\nfunction renderFavorites(): void {\n  const favoritesContent = document.getElementById('favoritesContent');\n  if (!favoritesContent) return;\n\n  const favorites = getFavorites();\n\n  if (favorites.length === 0) {\n    favoritesContent.innerHTML = `\n      <div class=\"favorites-empty\">\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n          <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\"/>\n          <path d=\"M8 7h6M8 11h8\"/>\n        </svg>\n        <p>No favorites yet</p>\n        <small>Tap the book icon to save books here</small>\n      </div>\n    `;\n    return;\n  }\n\n  favoritesContent.innerHTML = favorites\n    .map((book) => {\n      const coverUrl = getCoverUrl(book);\n      const author = book.authors[0]?.name || 'Unknown Author';\n      return `\n      <div class=\"favorite-item\" data-book-id=\"${book.id}\">\n        <div class=\"favorite-cover\">\n          ${\n            coverUrl\n              ? `<img src=\"${coverUrl}\" alt=\"${book.title}\" loading=\"lazy\">`\n              : `<div class=\"cover-placeholder-small\">${truncate(book.title, 20)}</div>`\n          }\n        </div>\n        <div class=\"favorite-info\">\n          <h3>${truncate(book.title, 50)}</h3>\n          <p>${author}</p>\n        </div>\n        <div class=\"favorite-actions\">\n          <a href=\"${getReadUrl(book)}\" target=\"_blank\" rel=\"noopener\" class=\"favorite-read-btn\" aria-label=\"Read book\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"/>\n              <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"/>\n            </svg>\n          </a>\n          <button class=\"favorite-remove-btn\" data-book-id=\"${book.id}\" aria-label=\"Remove from favorites\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `;\n    })\n    .join('');\n\n  // Setup remove buttons\n  favoritesContent.querySelectorAll('.favorite-remove-btn').forEach((btn) => {\n    btn.addEventListener('click', () => {\n      const bookId = parseInt((btn as HTMLElement).dataset.bookId || '0');\n      const favorites = getFavorites();\n      const book = favorites.find((b) => b.id === bookId);\n      if (book) {\n        toggleFavorite(book);\n        renderFavorites();\n        // Update favorite buttons in the feed\n        document.querySelectorAll(`.action-favorite-icon[data-book-id=\"${bookId}\"]`).forEach((feedBtn) => {\n          feedBtn.classList.remove('favorited');\n        });\n      }\n    });\n  });\n}\n\nfunction toggleFavoritesPanel(): void {\n  const panel = document.getElementById('favoritesPanel');\n  if (!panel) return;\n\n  const isOpen = panel.classList.contains('open');\n\n  if (isOpen) {\n    panel.classList.remove('open');\n  } else {\n    renderFavorites();\n    panel.classList.add('open');\n  }\n}\n\n// ============ UI Helper Functions ============\n\n/**\n * Setup logo refresh functionality - clicking the app name reloads the page\n */\nfunction setupLogoRefresh(element: Element | null): void {\n  if (!element) return;\n  element.addEventListener('click', () => location.reload());\n  (element as HTMLElement).style.cursor = 'pointer';\n}\n\n// ============ UI ============\n\nconst feed = document.getElementById('feed');\n\nconst bookFeed = new RandomBookFeed({\n  languages: 'en',\n  prefetchThreshold: CONFIG.PREFETCH_THRESHOLD,\n});\n\nlet bookCount = 0;\nlet isLoadingMore = false;\nlet observer: IntersectionObserver | null = null;\n\nfunction getCoverUrl(book: Book): string | null {\n  return book.formats['image/jpeg'] || null;\n}\n\nfunction getGutenbergUrl(book: Book): string {\n  return `https://www.gutenberg.org/ebooks/${book.id}`;\n}\n\nfunction getReadUrl(book: Book): string {\n  return book.formats['text/html'] || getGutenbergUrl(book);\n}\n\nfunction truncate(text: string | undefined, maxLength: number): string {\n  if (!text || text.length <= maxLength) return text || '';\n  return text.substring(0, maxLength).trim() + '...';\n}\n\nfunction createBookCard(book: Book): HTMLElement {\n  const coverUrl = getCoverUrl(book);\n  const author = book.authors[0]?.name || 'Unknown Author';\n  const summary = book.summaries?.[0] || 'No summary available for this classic work.';\n  const subjects = book.subjects?.slice(0, 3) || [];\n  const languages = book.languages || ['en'];\n\n  const card = document.createElement('article');\n  card.className = 'book-card';\n  card.innerHTML = `\n    <div class=\"card-bg\">\n      ${coverUrl ? `<img class=\"card-bg-image\" src=\"${coverUrl}\" alt=\"\" loading=\"lazy\">` : ''}\n      <div class=\"card-bg-overlay\"></div>\n      <div class=\"card-bg-pattern\"></div>\n    </div>\n\n    <div class=\"card-content\">\n      <header class=\"card-header\">\n        <span class=\"app-name\">BookWorm</span>\n        <button class=\"favorites-toggle-btn mobile-header-favorites\" aria-label=\"View favorites\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/>\n          </svg>\n          <span class=\"favorites-count\">0</span>\n        </button>\n      </header>\n\n      <div class=\"cover-container\">\n        <div class=\"book-cover\">\n          ${\n            coverUrl\n              ? `<img src=\"${coverUrl}\" alt=\"${book.title}\" loading=\"lazy\" class=\"cover-image\">`\n              : `<div class=\"cover-placeholder\">${truncate(book.title, 40)}</div>`\n          }\n        </div>\n      </div>\n\n      <div class=\"book-info\">\n        <h1 class=\"book-title\">${truncate(book.title, 70)}</h1>\n        <p class=\"book-author\">\n          <span class=\"author-line\"></span>\n          ${author}\n        </p>\n        <p class=\"book-summary\">${truncate(summary, 200)}</p>\n\n        <div class=\"book-tags\">\n          ${languages.map((lang) => `<span class=\"tag language\">${lang.toUpperCase()}</span>`).join('')}\n          ${subjects\n            .slice(0, 2)\n            .map((s) => `<span class=\"tag\">${truncate(s.split(' -- ')[0], 18)}</span>`)\n            .join('')}\n        </div>\n\n        <div class=\"book-actions\">\n          <a href=\"${getReadUrl(book)}\" target=\"_blank\" rel=\"noopener\" class=\"btn btn-primary\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"/>\n              <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"/>\n            </svg>\n            Read\n          </a>\n          <div class=\"icon-wrapper favorite-wrapper\">\n            <svg class=\"action-favorite-icon ${isFavorited(book.id) ? 'favorited' : ''}\" data-book-id=\"${book.id}\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" role=\"button\" aria-label=\"Add to favorites\">\n              <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"/>\n            </svg>\n          </div>\n          <div class=\"icon-wrapper link-wrapper\">\n            <svg class=\"copy-link-icon\" data-book-url=\"${getReadUrl(book)}\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" role=\"button\" aria-label=\"Copy link\">\n              <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"/>\n              <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"/>\n            </svg>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Setup logo refresh functionality\n  setupLogoRefresh(card.querySelector('.app-name'));\n\n  // Setup action favorite icon\n  const actionFavoriteIcon = card.querySelector('.action-favorite-icon');\n  if (actionFavoriteIcon) {\n    actionFavoriteIcon.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const isNowFavorited = toggleFavorite(book);\n      actionFavoriteIcon.classList.toggle('favorited', isNowFavorited);\n      actionFavoriteIcon.setAttribute(\n        'aria-label',\n        isNowFavorited ? 'Remove from favorites' : 'Add to favorites'\n      );\n    });\n  }\n\n  // Setup copy link icon\n  const copyLinkIcon = card.querySelector('.copy-link-icon');\n  if (copyLinkIcon) {\n    copyLinkIcon.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      const url = (copyLinkIcon as HTMLElement).dataset.bookUrl || '';\n      try {\n        await navigator.clipboard.writeText(url);\n        // Visual feedback\n        const originalHTML = copyLinkIcon.innerHTML;\n        copyLinkIcon.innerHTML = `<path d=\"M20 6L9 17l-5-5\"/>`;\n        copyLinkIcon.classList.add('copied');\n        setTimeout(() => {\n          copyLinkIcon.innerHTML = originalHTML;\n          copyLinkIcon.classList.remove('copied');\n        }, CONFIG.COPY_FEEDBACK_DURATION_MS);\n      } catch (err) {\n        console.error('Failed to copy link:', err);\n      }\n    });\n  }\n\n  // Setup mobile header favorites toggle\n  const mobileHeaderFavorites = card.querySelector('.mobile-header-favorites');\n  if (mobileHeaderFavorites) {\n    mobileHeaderFavorites.addEventListener('click', toggleFavoritesPanel);\n  }\n\n  // Setup image load handler\n  const coverImage = card.querySelector('.cover-image');\n  if (coverImage) {\n    coverImage.addEventListener('load', () => {\n      coverImage.classList.add('loaded');\n    });\n    coverImage.addEventListener('error', () => {\n      const placeholder = document.createElement('div');\n      placeholder.className = 'cover-placeholder';\n      placeholder.textContent = truncate(book.title, 40);\n      coverImage.parentElement?.replaceChild(placeholder, coverImage);\n    });\n  }\n\n  return card;\n}\n\nfunction createLoadingCard(): HTMLElement {\n  const card = document.createElement('div');\n  card.className = 'loading-card';\n  card.id = 'loading-sentinel';\n  card.innerHTML = `\n    <div class=\"loader\"></div>\n    <p class=\"loading-text\">Discovering more books...</p>\n  `;\n  return card;\n}\n\nasync function loadMoreBooks(count = CONFIG.LOAD_MORE_COUNT): Promise<void> {\n  if (isLoadingMore || !feed) return;\n  isLoadingMore = true;\n\n  try {\n    const { books, hasMore } = await bookFeed.getNext(count);\n\n    const sentinel = document.getElementById('loading-sentinel');\n    if (sentinel) sentinel.remove();\n\n    books.forEach((book) => {\n      const card = createBookCard(book);\n      feed.appendChild(card);\n      bookCount++;\n    });\n\n    if (hasMore) {\n      feed.appendChild(createLoadingCard());\n      observeLoadingSentinel();\n    }\n  } catch (error) {\n    console.error('Failed to load books:', error);\n  } finally {\n    isLoadingMore = false;\n  }\n}\n\nfunction observeLoadingSentinel(): void {\n  if (observer) observer.disconnect();\n\n  observer = new IntersectionObserver(\n    (entries) => {\n      if (entries[0]?.isIntersecting && !isLoadingMore) {\n        loadMoreBooks(CONFIG.LOAD_MORE_COUNT);\n      }\n    },\n    { rootMargin: CONFIG.INTERSECTION_ROOT_MARGIN, threshold: CONFIG.INTERSECTION_THRESHOLD }\n  );\n\n  const sentinel = document.getElementById('loading-sentinel');\n  if (sentinel) observer.observe(sentinel);\n}\n\nasync function init(): Promise<void> {\n  if (!feed) return;\n\n  feed.appendChild(createLoadingCard());\n\n  try {\n    await bookFeed.initialize();\n    feed.innerHTML = '';\n    await loadMoreBooks(CONFIG.LOAD_MORE_COUNT);\n  } catch (error) {\n    console.error('Failed to initialize:', error);\n    feed.innerHTML = `\n      <div class=\"error-state\">\n        <h2>Something went wrong</h2>\n        <p>We couldn't load the books. Please try again.</p>\n        <button class=\"btn btn-primary\" onclick=\"location.reload()\">\n          Refresh\n        </button>\n      </div>\n    `;\n  }\n}\n\ninit();\n\n// Setup desktop header logo refresh\nconst desktopHeader = document.getElementById('desktopHeader');\nif (desktopHeader) {\n  setupLogoRefresh(desktopHeader.querySelector('.app-name'));\n}\n\n// Setup favorites panel\nconst favoritesToggle = document.getElementById('favoritesToggle');\nconst favoritesClose = document.getElementById('favoritesClose');\n\nif (favoritesToggle) {\n  favoritesToggle.addEventListener('click', toggleFavoritesPanel);\n}\n\nif (favoritesClose) {\n  favoritesClose.addEventListener('click', toggleFavoritesPanel);\n}\n\n// Initialize favorites count\nupdateFavoritesCount();\n\n// Prevent middle mouse button auto-scroll\ndocument.addEventListener('mousedown', (e) => {\n  if (e.button === 1) {\n    e.preventDefault();\n  }\n});\n"],"names":["CONFIG","GUTENDEX_BASE_URL","createSeededRandom","seed","normalizedSeed","seededShuffle","array","random","shuffled","i","j","RandomBookFeed","options","data","b","count","ids","attempts","maxAttempts","id","url","response","error","targetCount","collected","rounds","maxRounds","idsToTry","randomIds","books","foundIds","resolve","reject","timeout","check","FAVORITES_KEY","favoritesCache","getFavorites","stored","favorites","saveFavorites","e","isFavorited","bookId","book","toggleFavorite","index","updateFavoritesCount","el","renderFavorites","favoritesContent","coverUrl","getCoverUrl","author","_a","truncate","getReadUrl","btn","feedBtn","toggleFavoritesPanel","panel","setupLogoRefresh","element","feed","bookFeed","bookCount","isLoadingMore","observer","getGutenbergUrl","text","maxLength","createBookCard","summary","_b","subjects","_c","languages","card","lang","s","actionFavoriteIcon","isNowFavorited","copyLinkIcon","originalHTML","err","mobileHeaderFavorites","coverImage","placeholder","createLoadingCard","loadMoreBooks","hasMore","sentinel","observeLoadingSentinel","entries","init","desktopHeader","favoritesToggle","favoritesClose"],"mappings":"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"}