{"version":3,"file":"index-9e26gcVn.js","sources":["../../src/config.ts","../../src/utils/random.ts","../../src/api/gutendex.ts","../../src/core/feed.ts","../../src/core/favorites.ts","../../src/ui/bookCard.ts","../../src/ui/loading.ts","../../src/ui/favoritesPanel.ts","../../src/main.ts"],"sourcesContent":["/**\n * Configuration constants for BookWorm application\n */\n\nimport type { Config } from './types';\n\nexport const CONFIG: Config = {\n  // API\n  GUTENDEX_BASE_URL: 'https://gutendex.com',\n\n  // Feed Configuration\n  PREFETCH_THRESHOLD: 25, // Start prefetching when 25 books remain in buffer\n  INITIAL_BATCH_SIZE: 50, // Load 50 books upfront for large initial cache\n  LOAD_BATCH_SIZE: 30, // Load 30 more books in background\n  LOAD_MORE_COUNT: 7,\n  MAX_ROUNDS: 5,\n  ID_MULTIPLIER: 2.0, // Request 2x IDs to minimize API round trips (~93% hit rate)\n  MAX_ID_ATTEMPTS_MULTIPLIER: 10,\n\n  // Catalog Settings\n  MIN_CATALOG_ID: 1,\n  MAX_CATALOG_ID: 75000,\n  MAX_CATALOG_PERCENTAGE: 0.9, // Stop when 90% of IDs have been tried\n  MAX_ID_BUFFER: 500, // Add buffer when determining max ID\n\n  // Timing\n  LOADING_POLL_INTERVAL_MS: 100,\n  LOADING_TIMEOUT_MS: 30000, // 30 seconds max wait\n  COPY_FEEDBACK_DURATION_MS: 2000,\n\n  // Intersection Observer\n  INTERSECTION_ROOT_MARGIN: '200px',\n  INTERSECTION_THRESHOLD: 0,\n};\n\n// UI Configuration (extracted magic numbers)\nexport const UI_CONFIG = {\n  // Title font sizing\n  TITLE_MAX_LINES: 2,\n  TITLE_FONT_SIZE_SMALL: 'clamp(1.2rem, 4.5vw, 1.7rem)',\n  TITLE_FONT_SIZE_DEFAULT: 'clamp(1.4rem, 5vw, 1.9rem)',\n\n  // Text truncation\n  TITLE_MAX_LENGTH: 70,\n  AUTHOR_DISPLAY_MAX_LENGTH: 50,\n  SUMMARY_MAX_LENGTH: 200,\n  SUBJECT_MAX_LENGTH: 12,\n  COVER_PLACEHOLDER_MAX_LENGTH: 40,\n  FAVORITE_TITLE_MAX_LENGTH: 50,\n  FAVORITE_PLACEHOLDER_MAX_LENGTH: 20,\n\n  // UI limits\n  MAX_SUBJECTS_DISPLAYED: 2,\n  MAX_TOTAL_TAGS: 3,\n\n  // Image preloading\n  PRELOAD_IMAGE_COUNT: 3,\n\n  // IntersectionObserver\n  TITLE_OBSERVER_ROOT_MARGIN: '50px',\n};\n\n// Memory Management Configuration (Phase 1 improvement)\nexport const MEMORY_CONFIG = {\n  MAX_SEEN_IDS: 10000, // Maximum IDs to keep in memory\n  CLEANUP_KEEP_COUNT: 5000, // How many recent IDs to keep after cleanup\n  FAVORITES_STORAGE_KEY: 'bookworm_favorites',\n  LOCALSTORAGE_SAVE_DEBOUNCE_MS: 300,\n};\n","/**\n * Seeded random number generation utilities\n */\n\nimport type { SeededRandomFunction } from '../types';\n\n/**\n * Creates a seeded pseudo-random number generator using SplitMix32 algorithm\n * Based on MurmurHash3's finalizer\n *\n * @param seed - Initial seed value (will be normalized to 32-bit integer)\n * @returns Function that returns random numbers in range [0, 1)\n */\nexport function createSeededRandom(seed: number): SeededRandomFunction {\n  // Normalize seed to handle edge cases\n  // Convert to number, default to current timestamp if invalid\n  let normalizedSeed = Number(seed);\n\n  // Handle NaN, Infinity, or other invalid values\n  if (!isFinite(normalizedSeed)) {\n    normalizedSeed = Date.now();\n  }\n\n  // Convert to 32-bit integer to ensure consistent behavior\n  normalizedSeed = normalizedSeed | 0;\n\n  return function (): number {\n    // SplitMix32 algorithm\n    // 0x6D2B79F5 is a magic constant from MurmurHash3\n    let t = (normalizedSeed += 0x6d2b79f5);\n    t = Math.imul(t ^ (t >>> 15), t | 1);\n    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);\n\n    // Convert to [0, 1) range\n    // >>> 0 converts to unsigned 32-bit integer\n    // Division by 2^32 normalizes to [0, 1)\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n  };\n}\n\n/**\n * Shuffles an array using the Fisher-Yates algorithm with a seeded RNG\n * Creates a new array; does not mutate the original\n *\n * @param array - Array to shuffle (shallow copied)\n * @param random - Seeded random function returning [0, 1)\n * @returns New shuffled array\n */\nexport function seededShuffle<T>(array: T[], random: SeededRandomFunction): T[] {\n  const shuffled = [...array];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(random() * (i + 1));\n    [shuffled[i]!, shuffled[j]!] = [shuffled[j]!, shuffled[i]!];\n  }\n  return shuffled;\n}\n","/**\n * Gutendex API client for fetching books from Project Gutenberg\n */\n\nimport type { Book, GutendexResponse } from '../types';\n\nconst GUTENDEX_BASE_URL = 'https://gutendex.com';\n\n/**\n * Fetch the maximum book ID in the catalog\n * @returns The highest book ID, or null if fetch fails\n */\nexport async function fetchMaxCatalogId(): Promise<number | null> {\n  try {\n    const response = await fetch(`${GUTENDEX_BASE_URL}/books?sort=descending`);\n    const data: GutendexResponse = await response.json();\n    if (data.results && data.results.length > 0) {\n      return Math.max(...data.results.map((b) => b.id));\n    }\n    return null;\n  } catch (error) {\n    console.error('Failed to fetch max catalog ID:', error);\n    return null;\n  }\n}\n\n/**\n * Fetch books by their IDs using Gutendex batch endpoint\n * @param ids - Array of book IDs to fetch\n * @param languages - Optional language filter (e.g., 'en')\n * @returns Array of books, empty if fetch fails\n */\nexport async function fetchBooksByIds(\n  ids: number[],\n  languages?: string | null\n): Promise<Book[]> {\n  if (ids.length === 0) return [];\n\n  const url = new URL(`${GUTENDEX_BASE_URL}/books`);\n  url.searchParams.append('ids', ids.join(','));\n\n  if (languages) {\n    url.searchParams.append('languages', languages);\n  }\n\n  try {\n    const response = await fetch(url.toString());\n    if (!response.ok) throw new Error(`HTTP ${response.status}`);\n    const data: GutendexResponse = await response.json();\n    return data.results || [];\n  } catch (error) {\n    console.error('Batch fetch error:', error);\n    return [];\n  }\n}\n","/**\n * Random Book Feed - Manages infinite book discovery with intelligent prefetching\n */\n\nimport type {\n  Book,\n  RandomBookFeedOptions,\n  FeedStats,\n  GetNextResult,\n  SeededRandomFunction,\n} from '../types';\nimport { CONFIG, MEMORY_CONFIG } from '../config';\nimport { createSeededRandom, seededShuffle } from '../utils/random';\nimport { fetchMaxCatalogId, fetchBooksByIds } from '../api/gutendex';\n\n/**\n * RandomBookFeed - Samples individual random IDs across entire catalog\n * Uses batch ID queries for efficiency while maintaining true randomness\n */\nexport class RandomBookFeed {\n  private seed: number;\n  private random: SeededRandomFunction;\n  private languages: string | null;\n  private prefetchThreshold: number;\n  private minId: number;\n  private maxId: number;\n  private buffer: Book[] = [];\n  private seenIds = new Set<number>();\n  private failedIds = new Set<number>();\n  private isInitialized = false;\n  private isLoading = false;\n  private hasMore = true;\n  private totalAttempted = 0;\n  private totalFound = 0;\n\n  constructor(options: RandomBookFeedOptions = {}) {\n    this.seed = options.seed || Date.now();\n    this.random = createSeededRandom(this.seed);\n    this.languages = options.languages || null;\n    this.prefetchThreshold = options.prefetchThreshold || CONFIG.PREFETCH_THRESHOLD;\n\n    // ID range for Gutenberg (approximately 1 to 75000, with gaps)\n    this.minId = CONFIG.MIN_CATALOG_ID;\n    this.maxId = CONFIG.MAX_CATALOG_ID;\n  }\n\n  async initialize(): Promise<{ maxId: number; seed: number }> {\n    if (this.isInitialized) {\n      return { maxId: this.maxId, seed: this.seed };\n    }\n\n    // Get the highest ID to refine our range\n    const maxCatalogId = await fetchMaxCatalogId();\n    if (maxCatalogId !== null) {\n      // Set maxId slightly above the highest known ID\n      this.maxId = maxCatalogId + CONFIG.MAX_ID_BUFFER;\n    }\n\n    // Pre-fill buffer with initial batch\n    await this.loadRandomBatch(CONFIG.INITIAL_BATCH_SIZE);\n    this.isInitialized = true;\n\n    return { maxId: this.maxId, seed: this.seed };\n  }\n\n  /**\n   * Phase 1 Improvement: Clean up old IDs to prevent unlimited memory growth\n   */\n  private cleanupOldIds(): void {\n    if (this.seenIds.size > MEMORY_CONFIG.MAX_SEEN_IDS) {\n      // Keep only the most recent IDs\n      const recentIds = Array.from(this.seenIds).slice(-MEMORY_CONFIG.CLEANUP_KEEP_COUNT);\n      this.seenIds = new Set(recentIds);\n\n      console.log(`Memory cleanup: Reduced seenIds from ${MEMORY_CONFIG.MAX_SEEN_IDS} to ${this.seenIds.size}`);\n    }\n\n    // Also cleanup failed IDs if they grow too large\n    if (this.failedIds.size > MEMORY_CONFIG.MAX_SEEN_IDS) {\n      const recentFailedIds = Array.from(this.failedIds).slice(-MEMORY_CONFIG.CLEANUP_KEEP_COUNT);\n      this.failedIds = new Set(recentFailedIds);\n\n      console.log(`Memory cleanup: Reduced failedIds from ${MEMORY_CONFIG.MAX_SEEN_IDS} to ${this.failedIds.size}`);\n    }\n  }\n\n  /**\n   * Generate N unique random IDs we haven't tried yet\n   */\n  private generateRandomIds(count: number): number[] {\n    const ids = new Set<number>();\n    let attempts = 0;\n    const maxAttempts = count * CONFIG.MAX_ID_ATTEMPTS_MULTIPLIER;\n\n    while (ids.size < count && attempts < maxAttempts) {\n      const id = Math.floor(this.random() * this.maxId) + this.minId;\n      if (!this.seenIds.has(id) && !this.failedIds.has(id)) {\n        ids.add(id);\n      }\n      attempts++;\n    }\n\n    return Array.from(ids);\n  }\n\n  /**\n   * Load a batch of random books\n   */\n  private async loadRandomBatch(targetCount = 10): Promise<void> {\n    if (this.isLoading) return;\n    this.isLoading = true;\n\n    try {\n      let collected: Book[] = [];\n      let rounds = 0;\n      const maxRounds = CONFIG.MAX_ROUNDS;\n\n      // Keep trying until we have enough books or hit max rounds\n      while (collected.length < targetCount && rounds < maxRounds) {\n        // Request more IDs than needed to account for invalid ones\n        // Gutenberg has ~70k books across ~75k IDs, so ~93% hit rate\n        const idsToTry = Math.ceil((targetCount - collected.length) * CONFIG.ID_MULTIPLIER);\n        const randomIds = this.generateRandomIds(idsToTry);\n\n        this.totalAttempted += randomIds.length;\n\n        // Mark all as seen to prevent re-fetching\n        randomIds.forEach((id) => this.seenIds.add(id));\n\n        // Fetch books\n        const books = await fetchBooksByIds(randomIds, this.languages);\n\n        // Track which IDs were valid\n        const foundIds = new Set(books.map((b) => b.id));\n        randomIds.forEach((id) => {\n          if (!foundIds.has(id)) {\n            this.failedIds.add(id);\n          }\n        });\n\n        this.totalFound += books.length;\n        collected.push(...books);\n        rounds++;\n      }\n\n      // Shuffle the collected books for extra randomness\n      const shuffled = seededShuffle(collected, this.random);\n      this.buffer.push(...shuffled);\n\n      // Phase 1 Improvement: Cleanup memory periodically\n      this.cleanupOldIds();\n\n      // Check if we're running out of IDs\n      if (this.seenIds.size + this.failedIds.size > this.maxId * CONFIG.MAX_CATALOG_PERCENTAGE) {\n        this.hasMore = false;\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  async getNext(count = 1): Promise<GetNextResult> {\n    if (!this.isInitialized) {\n      await this.initialize();\n    }\n\n    // Prefetch if running low\n    if (this.buffer.length < this.prefetchThreshold && this.hasMore && !this.isLoading) {\n      this.loadRandomBatch(CONFIG.LOAD_BATCH_SIZE).catch(console.error);\n    }\n\n    // Wait for loading if buffer is empty\n    if (this.buffer.length === 0 && this.isLoading) {\n      await new Promise<void>((resolve, reject) => {\n        const timeout = setTimeout(() => {\n          clearInterval(check);\n          reject(new Error('Loading timeout - books failed to load'));\n        }, CONFIG.LOADING_TIMEOUT_MS);\n\n        const check = setInterval(() => {\n          if (!this.isLoading || this.buffer.length > 0) {\n            clearInterval(check);\n            clearTimeout(timeout);\n            resolve();\n          }\n        }, CONFIG.LOADING_POLL_INTERVAL_MS);\n      });\n    }\n\n    const books = this.buffer.splice(0, count);\n\n    // Trigger background prefetch\n    if (this.buffer.length < this.prefetchThreshold && this.hasMore && !this.isLoading) {\n      this.loadRandomBatch(CONFIG.LOAD_BATCH_SIZE).catch(console.error);\n    }\n\n    return {\n      books,\n      hasMore: this.hasMore || this.buffer.length > 0,\n    };\n  }\n\n  getStats(): FeedStats {\n    return {\n      attempted: this.totalAttempted,\n      found: this.totalFound,\n      hitRate:\n        this.totalAttempted > 0\n          ? ((this.totalFound / this.totalAttempted) * 100).toFixed(1) + '%'\n          : 'N/A',\n      bufferSize: this.buffer.length,\n      seenCount: this.seenIds.size,\n    };\n  }\n}\n","/**\n * Favorites management with localStorage persistence and DOM caching\n */\n\nimport type { Book, FavoritesList } from '../types';\nimport { MEMORY_CONFIG } from '../config';\n\n// Cache for favorites to avoid repeated localStorage reads\nlet favoritesCache: FavoritesList | null = null;\n\n// Cache DOM elements to avoid repeated queries\nlet cachedDOMElements: {\n  favoritesCount: HTMLElement[];\n} | null = null;\n\n/**\n * Initialize and cache frequently accessed DOM elements\n */\nexport function initializeFavoritesDOM(): void {\n  cachedDOMElements = {\n    favoritesCount: Array.from(document.querySelectorAll('.favorites-count')),\n  };\n}\n\n/**\n * Get cached DOM elements, initializing if needed\n */\nfunction getDOMElements() {\n  if (!cachedDOMElements) {\n    initializeFavoritesDOM();\n  }\n  return cachedDOMElements!;\n}\n\n/**\n * Get favorites from cache or localStorage\n */\nexport function getFavorites(): FavoritesList {\n  // Return cached value if available\n  if (favoritesCache !== null) {\n    return favoritesCache;\n  }\n\n  try {\n    const stored = localStorage.getItem(MEMORY_CONFIG.FAVORITES_STORAGE_KEY);\n    const favorites: FavoritesList = stored ? JSON.parse(stored) : [];\n    favoritesCache = favorites;\n    return favorites;\n  } catch (e) {\n    console.error('Failed to load favorites:', e);\n    favoritesCache = [];\n    return [];\n  }\n}\n\n/**\n * Save favorites to localStorage and update cache\n */\nexport function saveFavorites(favorites: FavoritesList): void {\n  try {\n    localStorage.setItem(MEMORY_CONFIG.FAVORITES_STORAGE_KEY, JSON.stringify(favorites));\n    // Update cache on successful save\n    favoritesCache = favorites;\n  } catch (e) {\n    console.error('Failed to save favorites:', e);\n\n    // Handle quota exceeded error\n    if (e instanceof Error && e.name === 'QuotaExceededError') {\n      alert('Storage quota exceeded! Your favorites list is full. Please remove some items to add new ones.');\n    } else {\n      alert('Failed to save favorites. Please try again.');\n    }\n\n    // Re-throw to let caller know save failed\n    throw e;\n  }\n}\n\n/**\n * Check if a book is favorited\n */\nexport function isFavorited(bookId: number): boolean {\n  const favorites = getFavorites();\n  return favorites.some((book) => book.id === bookId);\n}\n\n/**\n * Toggle favorite status of a book\n * @returns true if added, false if removed\n */\nexport function toggleFavorite(book: Book): boolean {\n  const favorites = getFavorites();\n  const index = favorites.findIndex((b) => b.id === book.id);\n\n  if (index >= 0) {\n    // Remove from favorites\n    favorites.splice(index, 1);\n  } else {\n    // Add to favorites\n    favorites.push(book);\n  }\n\n  try {\n    saveFavorites(favorites);\n    updateFavoritesCount();\n    return index < 0; // Return true if added, false if removed\n  } catch (e) {\n    // Save failed, revert the change\n    if (index >= 0) {\n      favorites.push(book);\n    } else {\n      favorites.pop();\n    }\n    return index >= 0; // Return current state (unchanged)\n  }\n}\n\n/**\n * Phase 1 Improvement: Update favorites count using cached DOM elements\n */\nexport function updateFavoritesCount(): void {\n  const count = getFavorites().length;\n  const elements = getDOMElements();\n\n  elements.favoritesCount.forEach((el) => {\n    el.textContent = count.toString();\n    // Keep badge hidden\n    el.style.display = 'none';\n  });\n}\n\n/**\n * Refresh cached DOM elements (call after DOM updates)\n */\nexport function refreshFavoritesDOMCache(): void {\n  cachedDOMElements = null;\n  initializeFavoritesDOM();\n}\n","/**\n * Book card UI component and utilities\n */\n\nimport type { Book } from '../types';\nimport { CONFIG, UI_CONFIG } from '../config';\nimport { isFavorited, toggleFavorite } from '../core/favorites';\n\n/**\n * Get the cover image URL from a book\n */\nexport function getCoverUrl(book: Book): string | null {\n  return book.formats['image/jpeg'] || null;\n}\n\n/**\n * Get the Gutenberg project URL for a book\n */\nexport function getGutenbergUrl(book: Book): string {\n  return `https://www.gutenberg.org/ebooks/${book.id}`;\n}\n\n/**\n * Get the reading URL (HTML format or fallback to Gutenberg page)\n */\nexport function getReadUrl(book: Book): string {\n  return book.formats['text/html'] || getGutenbergUrl(book);\n}\n\n/**\n * Truncate text to a maximum length\n */\nexport function truncate(text: string | undefined, maxLength: number): string {\n  if (!text || text.length <= maxLength) return text || '';\n  return text.substring(0, maxLength).trim() + '...';\n}\n\n/**\n * Setup logo refresh functionality - clicking the app name reloads the page\n */\nexport function setupLogoRefresh(element: Element | null): void {\n  if (!element) return;\n  element.addEventListener('click', () => location.reload());\n  (element as HTMLElement).style.cursor = 'pointer';\n}\n\n/**\n * Create a book card element with all interactions\n */\nexport function createBookCard(book: Book, onFavoritesPanelToggle: () => void): HTMLElement {\n  const coverUrl = getCoverUrl(book);\n  const author = book.authors[0]?.name || 'Unknown Author';\n  const summary = book.summaries?.[0] || 'No summary available for this classic work.';\n  const subjects = book.subjects?.slice(0, UI_CONFIG.MAX_TOTAL_TAGS) || [];\n  const languages = book.languages || ['en'];\n\n  const card = document.createElement('article');\n  card.className = 'book-card';\n  card.innerHTML = `\n    <div class=\"card-bg\">\n      ${coverUrl ? `<img class=\"card-bg-image\" src=\"${coverUrl}\" alt=\"\" loading=\"lazy\">` : ''}\n      <div class=\"card-bg-overlay\"></div>\n      <div class=\"card-bg-pattern\"></div>\n    </div>\n\n    <div class=\"card-content\">\n      <header class=\"card-header\">\n        <span class=\"app-name\">BookWorm</span>\n        <button class=\"favorites-toggle-btn mobile-header-favorites\" aria-label=\"View favorites\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/>\n          </svg>\n          <span class=\"favorites-count\">0</span>\n        </button>\n      </header>\n\n      <div class=\"cover-container\">\n        <div class=\"book-cover\">\n          ${\n            coverUrl\n              ? `<img src=\"${coverUrl}\" alt=\"${book.title}\" loading=\"eager\" class=\"cover-image\" decoding=\"async\">`\n              : `<div class=\"cover-placeholder\">${truncate(book.title, UI_CONFIG.COVER_PLACEHOLDER_MAX_LENGTH)}</div>`\n          }\n        </div>\n      </div>\n\n      <div class=\"book-info\">\n        <h1 class=\"book-title\">${truncate(book.title, UI_CONFIG.TITLE_MAX_LENGTH)}</h1>\n        <p class=\"book-author\">\n          <span class=\"author-line\"></span>\n          ${author}\n        </p>\n        <p class=\"book-summary\">${truncate(summary, UI_CONFIG.SUMMARY_MAX_LENGTH)}</p>\n\n        <div class=\"book-tags\">\n          ${languages.map((lang) => `<span class=\"tag language\">${lang.toUpperCase()}</span>`).join('')}\n          ${subjects\n            .slice(0, UI_CONFIG.MAX_SUBJECTS_DISPLAYED)\n            .map((s) => `<span class=\"tag\">${truncate(s.split(' -- ')[0], UI_CONFIG.SUBJECT_MAX_LENGTH)}</span>`)\n            .join('')}\n        </div>\n      </div>\n\n      <div class=\"book-actions\">\n        <a href=\"${getReadUrl(book)}\" target=\"_blank\" rel=\"noopener\" class=\"btn btn-primary\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"/>\n            <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"/>\n          </svg>\n          Read\n        </a>\n        <div class=\"icon-wrapper favorite-wrapper\">\n          <svg class=\"action-favorite-icon ${isFavorited(book.id) ? 'favorited' : ''}\" data-book-id=\"${book.id}\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" role=\"button\" aria-label=\"Add to favorites\">\n            <path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"/>\n          </svg>\n        </div>\n        <div class=\"icon-wrapper link-wrapper\">\n          <svg class=\"copy-link-icon\" data-book-url=\"${getReadUrl(book)}\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" role=\"button\" aria-label=\"Copy link\">\n            <path d=\"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\"/>\n            <path d=\"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\"/>\n          </svg>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Setup logo refresh functionality\n  setupLogoRefresh(card.querySelector('.app-name'));\n\n  // Setup action favorite icon\n  const actionFavoriteIcon = card.querySelector('.action-favorite-icon');\n  if (actionFavoriteIcon) {\n    actionFavoriteIcon.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const isNowFavorited = toggleFavorite(book);\n      actionFavoriteIcon.classList.toggle('favorited', isNowFavorited);\n      actionFavoriteIcon.setAttribute(\n        'aria-label',\n        isNowFavorited ? 'Remove from favorites' : 'Add to favorites'\n      );\n    });\n  }\n\n  // Setup copy link icon\n  const copyLinkIcon = card.querySelector('.copy-link-icon');\n  if (copyLinkIcon) {\n    copyLinkIcon.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      const url = (copyLinkIcon as HTMLElement).dataset.bookUrl || '';\n      try {\n        await navigator.clipboard.writeText(url);\n        // Visual feedback\n        const originalHTML = copyLinkIcon.innerHTML;\n        copyLinkIcon.innerHTML = `<path d=\"M20 6L9 17l-5-5\"/>`;\n        copyLinkIcon.classList.add('copied');\n        setTimeout(() => {\n          copyLinkIcon.innerHTML = originalHTML;\n          copyLinkIcon.classList.remove('copied');\n        }, CONFIG.COPY_FEEDBACK_DURATION_MS);\n      } catch (err) {\n        console.error('Failed to copy link:', err);\n      }\n    });\n  }\n\n  // Setup mobile header favorites toggle\n  const mobileHeaderFavorites = card.querySelector('.mobile-header-favorites');\n  if (mobileHeaderFavorites) {\n    mobileHeaderFavorites.addEventListener('click', onFavoritesPanelToggle);\n  }\n\n  // Setup image load handler\n  const coverImage = card.querySelector('.cover-image');\n  if (coverImage) {\n    coverImage.addEventListener('load', () => {\n      coverImage.classList.add('loaded');\n    });\n    coverImage.addEventListener('error', () => {\n      const placeholder = document.createElement('div');\n      placeholder.className = 'cover-placeholder';\n      placeholder.textContent = truncate(book.title, UI_CONFIG.COVER_PLACEHOLDER_MAX_LENGTH);\n      coverImage.parentElement?.replaceChild(placeholder, coverImage);\n    });\n  }\n\n  // Adjust title font size if it exceeds 2 lines - optimized with IntersectionObserver\n  const titleElement = card.querySelector('.book-title');\n  if (titleElement) {\n    const checkTitleSize = () => {\n      const lineHeight = parseFloat(getComputedStyle(titleElement).lineHeight);\n      const height = titleElement.clientHeight;\n      const lines = Math.round(height / lineHeight);\n\n      if (lines > UI_CONFIG.TITLE_MAX_LINES) {\n        (titleElement as HTMLElement).style.fontSize = UI_CONFIG.TITLE_FONT_SIZE_SMALL;\n      }\n    };\n\n    // Use IntersectionObserver for better performance\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            checkTitleSize();\n            observer.disconnect(); // Only check once\n          }\n        });\n      },\n      { rootMargin: UI_CONFIG.TITLE_OBSERVER_ROOT_MARGIN }\n    );\n\n    observer.observe(card);\n  }\n\n  return card;\n}\n","/**\n * Loading UI components and infinite scroll management\n */\n\nimport type { Book } from '../types';\nimport { CONFIG, UI_CONFIG } from '../config';\nimport { createBookCard, getCoverUrl } from './bookCard';\n\n/**\n * Create a loading sentinel card for infinite scroll\n */\nexport function createLoadingCard(): HTMLElement {\n  const card = document.createElement('div');\n  card.className = 'loading-card';\n  card.id = 'loading-sentinel';\n  card.innerHTML = `\n    <div class=\"loader\"></div>\n    <p class=\"loading-text\">Discovering more books...</p>\n  `;\n  return card;\n}\n\n/**\n * Phase 1 Improvement: Optimized image preloading\n * Preloads the first N book cover images\n */\nexport function preloadBookImages(books: Book[], count: number = UI_CONFIG.PRELOAD_IMAGE_COUNT): void {\n  books.slice(0, Math.min(count, books.length)).forEach((book) => {\n    const coverUrl = getCoverUrl(book);\n    if (coverUrl) {\n      const img = new Image();\n      img.src = coverUrl;\n    }\n  });\n}\n\n/**\n * Setup intersection observer for loading sentinel\n */\nexport function observeLoadingSentinel(\n  onIntersect: () => void,\n  isLoadingMore: { value: boolean }\n): IntersectionObserver {\n  const observer = new IntersectionObserver(\n    (entries) => {\n      if (entries[0]?.isIntersecting && !isLoadingMore.value) {\n        onIntersect();\n      }\n    },\n    {\n      rootMargin: CONFIG.INTERSECTION_ROOT_MARGIN,\n      threshold: CONFIG.INTERSECTION_THRESHOLD,\n    }\n  );\n\n  const sentinel = document.getElementById('loading-sentinel');\n  if (sentinel) {\n    observer.observe(sentinel);\n  }\n\n  return observer;\n}\n","/**\n * Favorites panel UI management\n */\n\nimport { getFavorites, toggleFavorite } from '../core/favorites';\nimport { getCoverUrl, getReadUrl, truncate } from './bookCard';\nimport { UI_CONFIG } from '../config';\n\n/**\n * Render the favorites panel content\n */\nexport function renderFavorites(): void {\n  const favoritesContent = document.getElementById('favoritesContent');\n  if (!favoritesContent) return;\n\n  const favorites = getFavorites();\n\n  if (favorites.length === 0) {\n    favoritesContent.innerHTML = `\n      <div class=\"favorites-empty\">\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n          <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\"/>\n          <path d=\"M8 7h6M8 11h8\"/>\n        </svg>\n        <p>No favorites yet</p>\n        <small>Tap the book icon to save books here</small>\n      </div>\n    `;\n    return;\n  }\n\n  favoritesContent.innerHTML = favorites\n    .map((book) => {\n      const coverUrl = getCoverUrl(book);\n      const author = book.authors[0]?.name || 'Unknown Author';\n      return `\n      <div class=\"favorite-item\" data-book-id=\"${book.id}\">\n        <div class=\"favorite-cover\">\n          ${\n            coverUrl\n              ? `<img src=\"${coverUrl}\" alt=\"${book.title}\" loading=\"lazy\">`\n              : `<div class=\"cover-placeholder-small\">${truncate(book.title, UI_CONFIG.FAVORITE_PLACEHOLDER_MAX_LENGTH)}</div>`\n          }\n        </div>\n        <div class=\"favorite-info\">\n          <h3>${truncate(book.title, UI_CONFIG.FAVORITE_TITLE_MAX_LENGTH)}</h3>\n          <p>${author}</p>\n        </div>\n        <div class=\"favorite-actions\">\n          <a href=\"${getReadUrl(book)}\" target=\"_blank\" rel=\"noopener\" class=\"favorite-read-btn\" aria-label=\"Read book\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z\"/>\n              <path d=\"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z\"/>\n            </svg>\n          </a>\n          <button class=\"favorite-remove-btn\" data-book-id=\"${book.id}\" aria-label=\"Remove from favorites\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `;\n    })\n    .join('');\n\n  // Setup remove buttons\n  favoritesContent.querySelectorAll('.favorite-remove-btn').forEach((btn) => {\n    btn.addEventListener('click', () => {\n      const bookId = parseInt((btn as HTMLElement).getAttribute('data-book-id') ?? '0', 10);\n      const favorites = getFavorites();\n      const book = favorites.find((b) => b.id === bookId);\n      if (book) {\n        toggleFavorite(book);\n        renderFavorites();\n        // Update favorite buttons in the feed\n        document.querySelectorAll(`.action-favorite-icon[data-book-id=\"${bookId}\"]`).forEach((feedBtn) => {\n          feedBtn.classList.remove('favorited');\n        });\n      }\n    });\n  });\n}\n\n/**\n * Toggle the favorites panel open/closed\n */\nexport function toggleFavoritesPanel(): void {\n  const panel = document.getElementById('favoritesPanel');\n  if (!panel) return;\n\n  const isOpen = panel.classList.contains('open');\n\n  if (isOpen) {\n    panel.classList.remove('open');\n  } else {\n    renderFavorites();\n    panel.classList.add('open');\n  }\n}\n","/**\n * BookWorm - Main application entry point\n * Discover 70,000+ classic books from Project Gutenberg\n */\n\nimport { CONFIG } from './config';\nimport { RandomBookFeed } from './core/feed';\nimport {\n  initializeFavoritesDOM,\n  updateFavoritesCount,\n  refreshFavoritesDOMCache,\n} from './core/favorites';\nimport { setupLogoRefresh, createBookCard } from './ui/bookCard';\nimport {\n  createLoadingCard,\n  observeLoadingSentinel,\n  preloadBookImages,\n} from './ui/loading';\nimport { toggleFavoritesPanel } from './ui/favoritesPanel';\n\n// ============ Application State ============\n\nconst bookFeed = new RandomBookFeed({\n  languages: 'en',\n  prefetchThreshold: CONFIG.PREFETCH_THRESHOLD,\n});\n\n// Use ref object so observer can see state changes\nconst isLoadingMore = { value: false };\nlet observer: IntersectionObserver | null = null;\n\n// Phase 1 Improvement: Cached DOM references\nconst cachedDOM = {\n  feed: document.getElementById('feed'),\n  favoritesToggle: document.getElementById('favoritesToggle'),\n  favoritesClose: document.getElementById('favoritesClose'),\n  desktopHeader: document.getElementById('desktopHeader'),\n};\n\n// ============ Feed Management ============\n\n/**\n * Load more books into the feed\n * Phase 1 Improvement: Simplified image preloading logic\n */\nasync function loadMoreBooks(count = CONFIG.LOAD_MORE_COUNT): Promise<void> {\n  if (isLoadingMore.value || !cachedDOM.feed) return;\n  isLoadingMore.value = true;\n\n  try {\n    const { books, hasMore } = await bookFeed.getNext(count);\n\n    const sentinel = document.getElementById('loading-sentinel');\n    if (sentinel) sentinel.remove();\n\n    // Phase 1 Improvement: Simplified book card rendering\n    books.forEach((book) => {\n      const card = createBookCard(book, toggleFavoritesPanel);\n      cachedDOM.feed!.appendChild(card);\n    });\n\n    // Phase 1 Improvement: Optimized image preloading (separate from rendering)\n    preloadBookImages(books);\n\n    if (hasMore) {\n      cachedDOM.feed!.appendChild(createLoadingCard());\n      setupIntersectionObserver();\n    }\n  } catch (error) {\n    console.error('Failed to load books:', error);\n  } finally {\n    isLoadingMore.value = false;\n  }\n}\n\n/**\n * Setup intersection observer for infinite scroll\n */\nfunction setupIntersectionObserver(): void {\n  if (observer) observer.disconnect();\n\n  observer = observeLoadingSentinel(\n    () => loadMoreBooks(CONFIG.LOAD_MORE_COUNT),\n    isLoadingMore\n  );\n}\n\n// ============ Initialization ============\n\n/**\n * Initialize the application\n */\nasync function init(): Promise<void> {\n  if (!cachedDOM.feed) return;\n\n  cachedDOM.feed.appendChild(createLoadingCard());\n\n  try {\n    await bookFeed.initialize();\n    cachedDOM.feed.innerHTML = '';\n    await loadMoreBooks(CONFIG.LOAD_MORE_COUNT);\n  } catch (error) {\n    console.error('Failed to initialize:', error);\n    cachedDOM.feed.innerHTML = `\n      <div class=\"error-state\">\n        <h2>Something went wrong</h2>\n        <p>We couldn't load the books. Please try again.</p>\n        <button class=\"btn btn-primary\" onclick=\"location.reload()\">\n          Refresh\n        </button>\n      </div>\n    `;\n  }\n}\n\n// ============ Event Listeners Setup ============\n\n/**\n * Setup global event listeners\n */\nfunction setupEventListeners(): void {\n  // Setup desktop header logo refresh\n  if (cachedDOM.desktopHeader) {\n    setupLogoRefresh(cachedDOM.desktopHeader.querySelector('.app-name'));\n  }\n\n  // Setup favorites panel toggles\n  if (cachedDOM.favoritesToggle) {\n    cachedDOM.favoritesToggle.addEventListener('click', toggleFavoritesPanel);\n  }\n\n  if (cachedDOM.favoritesClose) {\n    cachedDOM.favoritesClose.addEventListener('click', toggleFavoritesPanel);\n  }\n\n  // Prevent middle mouse button auto-scroll\n  document.addEventListener('mousedown', (e) => {\n    if (e.button === 1) {\n      e.preventDefault();\n    }\n  });\n}\n\n// ============ Application Start ============\n\n// Phase 1 Improvement: Initialize DOM caching for favorites\ninitializeFavoritesDOM();\n\n// Setup all event listeners\nsetupEventListeners();\n\n// Initialize favorites count display\nupdateFavoritesCount();\n\n// Refresh DOM cache after initial setup\nrefreshFavoritesDOMCache();\n\n// Start the application\ninit();\n"],"names":["CONFIG","UI_CONFIG","MEMORY_CONFIG","createSeededRandom","seed","normalizedSeed","t","seededShuffle","array","random","shuffled","i","j","GUTENDEX_BASE_URL","fetchMaxCatalogId","data","b","error","fetchBooksByIds","ids","languages","url","response","RandomBookFeed","options","maxCatalogId","recentIds","recentFailedIds","count","attempts","maxAttempts","id","targetCount","collected","rounds","maxRounds","idsToTry","randomIds","books","foundIds","resolve","reject","timeout","check","favoritesCache","cachedDOMElements","initializeFavoritesDOM","getDOMElements","getFavorites","stored","favorites","saveFavorites","e","isFavorited","bookId","book","toggleFavorite","index","updateFavoritesCount","el","refreshFavoritesDOMCache","getCoverUrl","getGutenbergUrl","getReadUrl","truncate","text","maxLength","setupLogoRefresh","element","createBookCard","onFavoritesPanelToggle","coverUrl","author","_a","summary","_b","subjects","_c","card","lang","s","actionFavoriteIcon","isNowFavorited","copyLinkIcon","originalHTML","err","mobileHeaderFavorites","coverImage","placeholder","titleElement","checkTitleSize","lineHeight","height","observer","entries","entry","createLoadingCard","preloadBookImages","img","observeLoadingSentinel","onIntersect","isLoadingMore","sentinel","renderFavorites","favoritesContent","btn","feedBtn","toggleFavoritesPanel","panel","bookFeed","cachedDOM","loadMoreBooks","hasMore","setupIntersectionObserver","init","setupEventListeners"],"mappings":"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"}